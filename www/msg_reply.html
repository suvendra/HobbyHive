<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/index.css" />
	<script src="js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src="js/auth.js"></script>
    <title>My Hobby Hive</title>
</head>
<body>
	<header class="header">
		<div class="logo_prm"><img src="img/logo_small.png" /></div>
		<div class="page_title">My Messages</div>
		<div class="menu" id="menu"></div>
	</header>
	<div class="menu_container">
		<ul class="menu_item">
			<a href="#"><li>About Us</li></a>
			<a href="#"><li>Tell a Friend</li></a>
			<a href="#"><li>Career</li></a>
			<a href="#"><li>FAQ's</li></a>
			<a href="#"><li>Data Use Policy</li></a>
			<a href="#"><li>Cookies</li></a>
			<a href="#" id="logout"><li>Logout</li></a>
		</ul>
	</div>
	<div class="content">
	<form name="msg_reply" class="msg_reply" id="msg_reply" method="POST" action="">
		<div class="wall_title">REPLY</div>
		<div id="error"></div>
		<div class="write_wall"><textarea class="status" name="reply" id="reply" form="msg_reply" placeholder="Write your message here" rows="5"></textarea></div>
		<div class="form_submit">
			<div class="post submit"><input type="submit" name="submit" value="SEND" /></div>
		</div>
	</form>
	</div>
	<div class="msg_history">
		<div class="title">Message History</div>
		<div id="all_msg">
		<div class="msg_short">
			<ul class="msg_list">
				<li class="">
					<div class="msgr_img"><img src="img/frnd1.png"/></div>
					<div class="msg_body">
						<div class="msg_date">28-nov-2014</div>
						<div class="msg_author">Admin</div>
						<div class="msg_text">Lorem ipsum dolor sit amet, consectetur ...</div>
					</div>
				</li>
			</ul>
			<div class="delete_big"><span>delete</span></div>
		</div>
		<div class="msg_short">
			<ul class="msg_list">
				<li class="">
					<div class="msgr_img"><img src="img/frnd1.png"/></div>
					<div class="msg_body">
						<div class="msg_date">28-nov-2014</div>
						<div class="msg_author">Admin</div>
						<div class="msg_text">Lorem ipsum dolor sit amet, consectetur ...</div>
					</div>
				</li>
			</ul>
			<div class="delete_big"><span>delete</span></div>
		</div>
		<div class="msg_short">
			<ul class="msg_list">
				<li class="">
					<div class="msgr_img"><img src="img/frnd1.png"/></div>
					<div class="msg_body">
						<div class="msg_date">28-nov-2014</div>
						<div class="msg_author">Admin</div>
						<div class="msg_text">Lorem ipsum dolor sit amet, consectetur ...</div>
					</div>
				</li>
			</ul>
			<div class="delete_big"><span>delete</span></div>
		</div>
		<div class="msg_short">
			<ul class="msg_list">
				<li class="">
					<div class="msgr_img"><img src="img/frnd1.png"/></div>
					<div class="msg_body">
						<div class="msg_date">28-nov-2014</div>
						<div class="msg_author">Admin</div>
						<div class="msg_text">Lorem ipsum dolor sit amet, consectetur ...</div>
					</div>
				</li>
			</ul>
			<div class="delete_big"><span>delete</span></div>
		</div>
		<div class="msg_short">
			<ul class="msg_list">
				<li class="">
					<div class="msgr_img"><img src="img/frnd1.png"/></div>
					<div class="msg_body">
						<div class="msg_date">28-nov-2014</div>
						<div class="msg_author">Admin</div>
						<div class="msg_text">Lorem ipsum dolor sit amet, consectetur ...</div>
					</div>
				</li>
			</ul>
			<div class="delete_big"><span>delete</span></div>
		</div>
		<div class="msg_short">
			<ul class="msg_list">
				<li class="">
					<div class="msgr_img"><img src="img/frnd1.png"/></div>
					<div class="msg_body">
						<div class="msg_date">28-nov-2014</div>
						<div class="msg_author">Admin</div>
						<div class="msg_text">Lorem ipsum dolor sit amet, consectetur ...</div>
					</div>
				</li>
			</ul>
			<div class="delete_big"><span>delete</span></div>
		</div>
		<div class="msg_short">
			<ul class="msg_list">
				<li class="">
					<div class="msgr_img"><img src="img/frnd1.png"/></div>
					<div class="msg_body">
						<div class="msg_date">28-nov-2014</div>
						<div class="msg_author">Admin</div>
						<div class="msg_text">Lorem ipsum dolor sit amet, consectetur ...</div>
					</div>
				</li>
			</ul>
			<div class="delete_big"><span>delete</span></div>
		</div>
		</div>
		<div class="white_space"></div>
		<div class="white_space"></div>
	</div>
	<footer>
		<div class="links">
			<a href="social_wall.html"><div class="social_wall">Social Wall</div></a>
			<a href="profile.html"><div class="profile">Profile</div></a>
			<a href="messages.html"><div class="messages selected">Messages</div></a>
			<a href="diary.html"><div class="diary">Diary</div></a>
			<a href="join_club.html"><div class="hobby_link">Club Stuff</div></a>
		</div>
	</footer>
        <script type="text/javascript" src="cordova.js"></script>
        <!--script type="text/javascript">
            app.initialize();
        </script-->
		<script>
			$(document).ready(function(){		
			var id = localStorage.getItem("hobby_userID");
			var msg_id = localStorage.getItem("messagePK");
			var sendData = { "id": id, "msg_id": msg_id};
			$('body').append("<div class='loading'></div>");
			$.ajax({
				type: "POST",
				url: "http://www.mhhdev.com/mobileapp/newdb/msg_history.php",
				data: sendData,
				dataType: "json",
				success: function(data) {
					if(data['success'] == 1){
						var messages = [];
						for (var i in data['date']){
							messages.push("<div class='msg_short'>			<ul class='msg_list'>				<li class=''>					<div class='msgr_img'><img src='https://www.myhobbyhive.com/clubuserimages/profile/"+data['image'][i]+"'/></div>					<div class='msg_body'>						<div class='msg_date'>"+data['date'][i]+"</div>						<div class='msg_author'>From : "+data['sendername'][i]+"</div>						<div class='msg_text'>"+data['messagebody'][i]+"</div>					</div>				</li>			</ul>			<div class='delete_big' data-value="+data['messagePK'][i]+"><span>delete</span></div>		</div>");
						}
							$("#all_msg").html(messages.join(''));	
							$("#all_msg").data('value',data['senderID']);
						$('.loading').remove();
					}else {
						$('#all_msg').html("<div class='empty'>No recieved Messages</div>");
						$('.loading').remove();						
					}
					
				},
				error: function(data, textStatus, errorThrown) { 
					$('body').append("<div class='connection_error'>Unable to connect to internet</div>");
                } 
				});
				$("#all_msg").on('click','.msg_short',function(e){
					e.preventDefault();
					$(this).children(".delete_big").slideToggle();
				});
				$("#msg_reply").on('submit',function(e){
					e.preventDefault();
					$('body').append("<div class='loading'></div>");
					var senderID = $("#all_msg").data('value');
					var id = localStorage.getItem("hobby_userID");
					var reply = $("#reply").val();
					formdata = {'reply':reply,'id':id,'senderID':senderID};
					$.ajax({
						type: "POST",
						url: "http://www.mhhdev.com/mobileapp/newdb/msg_reply.php",
						data: formdata,
						dataType: "json",
						//contentType: false,
						//cache: false,
						//processData:false,
						success: function(data) {
							if(data["success"]==1){
								location.reload();
								$('.loading').remove();					
							} else {
								$("#error").html(data["message"]);
								$('.loading').remove();					
							}
						},
						error: function(data, textStatus, errorThrown) { 
							$('body').append("<div class='connection_error'>Unable to connect to internet</div>");						} 
					});
				});

			});
		</script>
</body>
</html>